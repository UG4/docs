<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ug4: Coupling of HLibPro</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ug4
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page_u_g4_h_lib.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Coupling of HLibPro </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#secCouplingUG4HLibPro_General">General</a></li>
<li class="level1"><a href="#secCouplingUG4HLibPro_ShortDesc">Short description of HLibPro functionality provided in ug4 so far:</a></li>
<li class="level1"><a href="#secCouplingUG4HLibPro_InstallationUG4">Installation/Usage in ug4 (Unix only)</a></li>
<li class="level1"><a href="#secCouplingUG4HLibPro_InstallationHLibPro">Installation of HLibPro</a></li>
<li class="level1"><a href="#secCouplingUG4HLibPro_Remarks">Remarks</a><ul><li class="level2"><a href="#secCouplingUG4HLibPro_Remarks_Python">Python</a></li>
<li class="level2"><a href="#secCouplingUG4HLibPro_Remarks_SCons">SCons</a></li>
<li class="level2"><a href="#secCouplingUG4HLibPro_Remarks_LAPACK">LAPACK</a></li>
<li class="level2"><a href="#secCouplingUG4HLibPro_Remarks_KnownProblems">Known problems</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><hr  />
 <h1><a class="anchor" id="secCouplingUG4HLibPro_General"></a>
General</h1>
<p>HLibPro is a parallel H-matrix library for shared and distributed memory machines. Hierarchical matrices, or H-matrices for short, are a powerful tool for numerical applications allowing the usage of the complete matrix algebra, e.g. matrix multiplication and inversion, with almost linear complexity (short description from <a href="http://www.hlibpro.com/">http://www.hlibpro.com/</a>).</p>
<p>NOTE: HLibPro is an external library, for which we do not provide the sources! Nevertheless our group has access to the HLibPro sources within "ASIL" project. Otherwise you may get a license contacting Dr. Ronald Kriemann, <a href="#" onclick="location.href='mai'+'lto:'+'rok'+'@m'+'is.'+'mp'+'g.d'+'e'; return false;">rok@m<span style="display: none;">.nosp@m.</span>is.m<span style="display: none;">.nosp@m.</span>pg.de</a>.</p>
<h1><a class="anchor" id="secCouplingUG4HLibPro_ShortDesc"></a>
Short description of HLibPro functionality provided in ug4 so far:</h1>
<p>Some functionality of HLibPro is used to define a sparse matrix solver (type 'IMatrixOperatorInverse'), based on the functions of the HLibPro C interface. See 'ugbase/lib_algebra/operator/linear_solver/hlibpro.h'.</p>
<p>For importing the system matrix assembled by UG to HLibPro a sparse matrix format is used. This format is implemented by a class 'CRSMatrix', which is also defined in 'hlibpro.h'.</p>
<p>The solver is registered as 'HLIBSolver' in 'lib_algebra_bridge.cpp'.</p>
<p>TODO: Import of coordinates and construction of cluster trees based on coordinates aren't implemented yet.</p>
<h1><a class="anchor" id="secCouplingUG4HLibPro_InstallationUG4"></a>
Installation/Usage in ug4 (Unix only)</h1>
<p>To use this HLibPro functionality from within ug4,</p>
<ol>
<li>
<p class="startli">get a copy of HLibPro (sources are not provided with ug4!) and place it somewhere on your filesystem, e.g. ~/bin/hlibpro-0.13.6/, then configure and build HLibPro. See below for some hints to do this!</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Check 'cmake/ug_includes.cmake': If necessary adapt path after 'PATH_SUFFIXES' (last argument of 'find_path()' call). In the moment this path is given relative to the location of 'cmake'.</p>
<p class="interli">E.g., if your HLibPro main directory resides in '~/bin/', then use</p>
<div class="fragment"><div class="line">find_path (HLIBPROLIB_DIR libhpro.a</div>
<div class="line">           PATHS ENV PATH</div>
<div class="line">           PATH_SUFFIXES ../bin/hlibpro-0.13.6/lib/ )</div>
</div><!-- fragment --><p class="interli">This works e.g. on 'cekon.gcsc.uni-frankfurt.de'. Sometimes it seems to be necessary to give 'PATH_SUFFIXES' relative to the ug4 main directory (observed e.g. on 'quadruped.gcsc.uni-frankfurt.de'):</p>
<div class="fragment"><div class="line">find_path (HLIBPROLIB_DIR libhpro.a</div>
<div class="line">           PATHS ENV PATH</div>
<div class="line">           PATH_SUFFIXES ../../bin/hlibpro-0.13.6/lib/ )</div>
</div><!-- fragment --><p class="interli">Everything else (e.g. include paths, including the path to the C interface header file 'hlib-c.hh') depends on 'PATH_SUFFIXES' and is automatically set.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Configure ug4 for using HLibPro, e.g.:</p>
<div class="fragment"><div class="line">% cmake &lt;other options&gt; -DHLIBPRO=ON  ../ # Enable HLibPro</div>
</div><!-- fragment --><p class="interli">To disable usage of HLibPro: </p><div class="fragment"><div class="line">% cmake &lt;other options&gt; -DHLIBPRO=OFF ../ # Disable HLibPro</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Compile ug4.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Script code for testing HLibPro is provided in</p>
<p class="interli">scripts/hlibtest.lua</p>
<p class="interli">Execute this script by running e.g.</p>
<div class="fragment"><div class="line">% mpirun -n 4 ./ugshell -<a class="code" href="command__line__util_8lua.html#a340d3719e63a0a3a4f4429ef8c8b55ea">ex</a> scripts/hlibtest.lua</div>
<div class="ttc" id="acommand__line__util_8lua_html_a340d3719e63a0a3a4f4429ef8c8b55ea"><div class="ttname"><a href="command__line__util_8lua.html#a340d3719e63a0a3a4f4429ef8c8b55ea">ex</a></div><div class="ttdeci">parameterString ex</div><div class="ttdoc">Executes the specified script.</div><div class="ttdef"><b>Definition:</b> command_line_util.lua:350</div></div>
</div><!-- fragment --><p class="endli">For (preliminary) tests for systems of pdes see scripts/systemlaplace_hlib.lua scripts/navierstokes_hlib.lua </p>
</li>
</ol>
<h1><a class="anchor" id="secCouplingUG4HLibPro_InstallationHLibPro"></a>
Installation of HLibPro</h1>
<p>To use the HLibPro configuration system, a Python interpreter is needed. Furthermore, the build system for HLibpro is 'SCons' (<a href="http://www.scons.org">http://www.scons.org</a>), which also is based on Python.</p>
<p>For further information to the build process of HLibpro we refer to the documentation included in the HLibpro sources, but for convenience we sketch the typical steps here (version 0.13.6; we assume, that the tar ball is placed in '~/bin/' (which probably isn't the most elegant place ...); consider also the "remarks" below):</p>
<ol>
<li>
<p class="startli">extract tar ball: </p><div class="fragment"><div class="line">% cd ~/bin/</div>
<div class="line">% tar xzf hlibpro-0.13.6.tgz</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">change into HLibPro main directory and configure HLibPro: </p><div class="fragment"><div class="line">% cd hlibpro-0.13.6</div>
<div class="line">% ./configure</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">compile HLibPro via 'scons' by simply typing </p><div class="fragment"><div class="line">% scons</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<p class="startli">Maybe execute the stand-alone test executables now available in the sub directory 'examples/': </p><div class="fragment"><div class="line">% cd examples</div>
<div class="line">% bem1d 100</div>
</div><!-- fragment --><p> etc.</p>
<p class="endli"></p>
</li>
</ol>
<h1><a class="anchor" id="secCouplingUG4HLibPro_Remarks"></a>
Remarks</h1>
<h2><a class="anchor" id="secCouplingUG4HLibPro_Remarks_Python"></a>
Python</h2>
<p>HLibPro's 'configure' script needs a "not to old python version", especially one whichs knows "subprocesses"! E.g. Python 2.4.3 is ok, Python 2.3.4 is not! So, if you get a message like the following </p><div class="fragment"><div class="line">quadruped@/home3/ingo/bin/hlibpro-0.13.6&gt; ./configure</div>
<div class="line">Traceback (most recent call last):</div>
<div class="line">  File <span class="stringliteral">&quot;./configure&quot;</span>, line 11, in ?</div>
<div class="line">    import subprocess</div>
<div class="line">ImportError: No module named subprocess</div>
</div><!-- fragment --><p>You have to update your Python installation first!</p>
<p>To do this (or to install it for the first time), get a copy of its current sources (see <a href="http://www.python.org">http://www.python.org</a>) and proceed as follows (this method does not require root access and is also feasible if there is no package available for your machine; in this example we place it in '~/bin/'): </p><div class="fragment"><div class="line">% cd ~/bin/</div>
<div class="line">% wget http:<span class="comment">//www.python.org/ftp/python/2.7.1/Python-2.7.1.tar.bz2</span></div>
<div class="line">% bunzip Python-2.7.1.tar.bz2</div>
<div class="line">% tar xvf Python-2.7.1.tar</div>
<div class="line">% cd Python-2.7.1</div>
</div><!-- fragment --><p> The build process consists of the usual </p><div class="fragment"><div class="line">% ./configure</div>
<div class="line">% make</div>
<div class="line">% make install # (<span class="keywordflow">if</span> you have appropriate rights)</div>
</div><!-- fragment --><p> in the "python main directory".</p>
<p>After all, to finally configure HLibPro you have to check the first line in HLibPro's 'configure' script, </p><div class="fragment"><div class="line"><span class="preprocessor">#!/usr/bin/env /usr/bin/python</span></div>
</div><!-- fragment --><p> and adapt it if needed to point to your new Python interpreter, e.g. change it to something like: </p><div class="fragment"><div class="line"><span class="preprocessor">#!/usr/bin/env /home3/ingo/bin/Python-2.7.1/python</span></div>
</div><!-- fragment --><p> Then you can type (as mentioned above): </p><div class="fragment"><div class="line">% cd ~/bin/hlibpro-0.13.6</div>
<div class="line">% ./configure</div>
</div><!-- fragment --><p> to configure HLibPro.</p>
<h2><a class="anchor" id="secCouplingUG4HLibPro_Remarks_SCons"></a>
SCons</h2>
<p>If you have to build and install 'SCons', get a copy of its current sources unpack them, change into the "scons main directory" and execute its Python- based setup script, e.g. (again we place everything in '~/bin/'):</p>
<div class="fragment"><div class="line">% cd ~/bin/</div>
<div class="line">% wget http:<span class="comment">//prdownloads.sourceforge.net/scons/scons-2.0.1.tar.gz</span></div>
<div class="line">% gunzip scons-2.0.1.tar.gz </div>
<div class="line">% tar xvf scons-2.0.1.tar</div>
<div class="line"> </div>
<div class="line">% cd scons-2.0.1</div>
<div class="line">% python setup.py install --prefix=&lt;install dir&gt; # e.g. <span class="stringliteral">&#39;--prefix=~/bin/scons&#39;</span>!</div>
</div><!-- fragment --><p> To finally compile HLibPro execute this version of 'scons' in the "HLibPro
main directory" e.g. by typing: </p><div class="fragment"><div class="line">% cd hlibpro-0.13.6</div>
<div class="line">% ~/bin/scons/bin/scons</div>
</div><!-- fragment --><h2><a class="anchor" id="secCouplingUG4HLibPro_Remarks_LAPACK"></a>
LAPACK</h2>
<p>Internally, HLibpro uses LAPACK for most arithmetic operations. For the case no such implementation is available, HLibpro can use a modified version of CLAPACK as a substitute for LAPACK. CLAPACK is contained in the sources of HLibPro.</p>
<p>By default HLibpro is linked against the substitute library, 'libclapack.a' ("by default" according to the provided documentation, 'hlibpro-user.pdf', but I'm in doubt about that, at least on OS X ...), which might result in a reduced performance of HLibpro.</p>
<p>In case an (probably) optimised version of LAPACK is available for your system it is therefore highly recommended to use this instead of CLAPACK. To do so, configure HLibpro this way: </p><div class="fragment"><div class="line">% ./configure --lapack=-Llapack</div>
</div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>There are cases where the substitute library 'libclapack.a' is needed (see "Known problems below"). To use CLAPACK, type <div class="fragment"><div class="line">% ./configure --lapack=-CLAPACK<span class="stringliteral">&#39;</span></div>
</div><!-- fragment --></dd></dl>
<h2><a class="anchor" id="secCouplingUG4HLibPro_Remarks_KnownProblems"></a>
Known problems</h2>
<ol>
<li>
<p class="startli">While building the executables in the 'examples/' directory the linker may drop the following error message: </p><pre class="fragment">    /usr/bin/ld: Undefined symbols:
    __Unwind_Resume
    collect2: ld returned 1 exit status
    scons: *** [examples/bem1d] Error 1
    scons: building terminated because of errors.
</pre><p> This seems to be a quite common problem with older versions of OS X / XCode when linking C++ software with gcc instead of g++.</p>
<p class="interli">Remedy: Use 'g++' for linking the HLibPro examples! Reason: 'g++' automatically links other system libraries than 'gcc' does, so that the otherwise undefined symbol can be resolved!</p>
<p class="interli">To achieve this, do: </p><div class="fragment"><div class="line">% ./configure --cc=g++</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
<ol>
<li>
<p class="startli">When attempting to start one of HLibPro's example executables maybe the following error message shows up, e.g. </p><div class="fragment"><div class="line">% bem1d 100</div>
<div class="line">% bem1d: symbol lookup error: bem1d: undefined symbol: slamch_</div>
</div><!-- fragment --><p> This behavior seems to be due to a too old (?) version of LAPACK on your system! It was observed with 3.0.3.(currently installed on 'quadruped'). In contrast, e.g. with Lapack 3.1.1 (currently installed on 'cekon') this problem does not occur.</p>
<p class="interli">Remedy: Use the substitute library 'libclapack.a' instead, i.e. configure HLibPro accordingly (cf. above): </p><div class="fragment"><div class="line">% ./configure --lapack=CLAPACK<span class="stringliteral">&#39;</span></div>
</div><!-- fragment --><p> to enforce building of 'libclapack.a'.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Independent of (but obviously directly related to) the problem above you may run in a similar problem when attempting to start 'ugshell' compiled with HLibPro: </p><div class="fragment"><div class="line">% ugshell -<a class="code" href="command__line__util_8lua.html#a340d3719e63a0a3a4f4429ef8c8b55ea">ex</a> ../scripts/laplace.lua</div>
<div class="line">% ugshell: symbol lookup error: ugshell: undefined symbol: slamch_</div>
</div><!-- fragment --><p> This may happen even if the stand-alone examples of HLibPro work properly - which is the case if HLibPro is linked against CLAPACK, but ug4's configuration via 'cmake' has automatically chosen the (too old) version of LAPACK installed on your system!</p>
<p class="interli">Remedy: Link ug4 also against the "LAPACK substitute", 'libclapack.a'!</p>
<p class="interli">To achieve this, add also 'libclapack.a' to the 'UG_LIBRARIES', i.e., edit the appropriate part in 'cmake/ug_includes.cmake': </p><div class="fragment"><div class="line"><span class="keywordflow">if</span>(HLIBPRO AND HLIBPROLIB_DIR)</div>
<div class="line">   set(UG_LIBRARIES ${UG_LIBRARIES} ${HLIBPROLIB_DIR}/libhpro.a ${HLIBPROLIB_DIR}/libclapack.a) # <span class="stringliteral">&#39;libclapack.a&#39;</span> added</div>
</div><!-- fragment --><p class="endli">(Perhaps/probably there exists a more elegant way, but it works ...) </p>
</li>
</ol>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">ug4 - Documentation</a></li><li class="navelem"><a class="el" href="page_u_g4_setup.html">Setup and Installation</a></li>
    <li class="footer">Generated on Mon Jul 10 2023 01:16:15 for ug4 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
