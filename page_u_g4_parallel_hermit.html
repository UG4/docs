<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ug4: Hermit</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ug4
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page_u_g4_parallel_hermit.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Hermit </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a class="el" href="page_u_g4_parallel_hermit.html#secHermit_Architecture">Architecture</a></li>
<li><a class="el" href="page_u_g4_parallel_hermit.html#secHermit_General">General</a></li>
<li><a class="el" href="page_u_g4_parallel_hermit.html#secHermit_GCC">GCC</a></li>
<li><a class="el" href="page_u_g4_parallel_hermit.html#secHermit_Cray">Cray CC</a></li>
<li><a class="el" href="page_u_g4_parallel_hermit.html#secHermit_Workspace">Workspace Mechanism</a></li>
<li><a class="el" href="page_u_g4_parallel_hermit.html#secHermit_Debugging">Debugging on Hermit</a></li>
</ul>
<hr  />
 <h1><a class="anchor" id="secHermit_Architecture"></a>
Architecture</h1>
<p>The <a href="https://wickie.hlrs.de/platforms/index.php/Cray_XE6">Cray XE6 ("Hermit")</a>. In Installation step 1, the XE6 is a 3552 node cluster. Each node is a Dual Socket <a href="http://en.wikipedia.org/wiki/List_of_AMD_Opteron_microprocessors#Opteron_6200-series_.22Interlagos.22_.2832_nm.29">AMD Opteron 6276 (Interlagos)</a> @ 2.3GHz 16 cores each, which results in 113.664 cores in total. Normal nodes have 32 GB RAM, 480 special nodes have 64 GB (total 126 TB). (<a href="https://wickie.hlrs.de/platforms/index.php/CRAY_XE6_Hardware_and_Architecture">Architecture</a>) That is 1 GB RAM for each process when running the maximum of 32 processes on a node. Current maximum number of cores for one job is 64000. Speak to the administration for more nodes.</p>
<hr  />
 <h1><a class="anchor" id="secHermit_General"></a>
General</h1>
<p>Be aware that hermit blocks all connections to the normal internet. You have to use secSVNSSHTunneling to check out on Hermit, and use uginstall's -svnServer option (see <a class="el" href="page_uginstall.html">uginstall - Scripts for installation</a>).</p>
<p>The Job Scheduler on Hermit is supported by <a class="el" href="pageugsubmit.html">ugsubmit</a> for unified job scheduling on all clusters. You might want to use -Hermit-workspace .</p>
<ul>
<li><a href="https://wickie.hlrs.de/platforms/index.php/DDT">Debugging with DDT</a></li>
<li><a href="https://wickie.hlrs.de/platforms/index.php/Software_Development_Tools,_Compilers_%26_Libraries">Available software </a></li>
<li><a href="https://wickie.hlrs.de/platforms/index.php/Module_command">The module command</a></li>
<li><a href="https://wickie.hlrs.de/platforms/index.php/CRAY_XE6_Using_the_Batch_System">Batch system</a> (recommended is <a class="el" href="pageugsubmit.html">ugsubmit</a>)</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>You have to choose modules every time you log in (you might want to add your <code>module load/swap</code> commands into your <code>.bashrc</code> or similar ).</dd></dl>
<hr  />
 <h1><a class="anchor" id="secHermit_GCC"></a>
GCC</h1>
<p>First, look what modules are loaded </p><pre class="fragment">module list
</pre><p>There is one which is named PrgEnv-cray or PrgEnv-*. Now you swap that to PrgEnv-gnu: </p><pre class="fragment">module swap PrgEnv-cray PrgEnv-gnu
</pre><p>There's a one-liner for this task: </p><pre class="fragment">module swap $(module li 2&gt;&amp;1 | awk '/PrgEnv/{print $2}') PrgEnv-gnu
</pre><p>Then you start cmake with a <a class="el" href="page_u_g4_setup_parallel.html#secCMake_ToolchainFiles">Toolchain File</a> : </p><pre class="fragment">cmake -DCMAKE_TOOLCHAIN_FILE=../cmake/toolchain/hermit.cmake ..
</pre><hr  />
 <h1><a class="anchor" id="secHermit_Cray"></a>
Cray CC</h1>
<p>The Cray C Compiler is not working at the moment because there is an internal compiler error in release mode.</p>
<p>Toolchain file is <code>../cmake/toolchain/hermit.cmake</code>, and the module is PrgEnv-cray. </p><pre class="fragment">module swap $(module li 2&gt;&amp;1 | awk '/PrgEnv/{print $2}') PrgEnv-cray
cmake -DCMAKE_TOOLCHAIN_FILE=../cmake/toolchain/hermit.cmake ..
</pre><hr  />
 <h1><a class="anchor" id="secHermit_Workspace"></a>
Workspace Mechanism</h1>
<p>Access to the user file system (anything in your home directory) from your running job is very slow on Hermit. It is very noticable in runs with 1024 cores and even if you are accessing only small files once like your script files. The <a href="https://wickie.hlrs.de/platforms/index.php/Workspace_mechanism">Workspace Mechanism</a> lets you create a directory on a specialized parallel file system. First create a workspace in ug4: </p><pre class="fragment">ln -s `ws_allocate ug4ws 31` workspace
</pre><p> Before each time you run ugshell, you'll have to run a script like the following: </p><pre class="fragment">mkdir -p workspace/ugcore
rsync -a -W --exclude=.git ugcore/scripts/ workspace/ugcore/scripts/
rsync -a -W --exclude=.svn apps/ workspace/apps/
export UG4_ROOT=workspace
</pre><p> See also <a href="http://linux.die.net/man/1/rsync">rsync docu</a> (-a = subdirectories and keep date, -W = whole files).</p>
<p>Now start your job with ugsubmit from inside your workspace.</p>
<p>Be aware that also files written to can be damaged if you are not using the Workspace mechanism. See also the "-dir" and "-Hermit-workspace" option in <a class="el" href="pageugsubmit.html">ugsubmit - Job Scheduling on Clusters</a>.</p>
<p>Note the export UG4_ROOT-part: </p><pre class="fragment">export UG4_ROOT=$runDir
</pre><p> If this environment variable is not specified, <b>ug4</b> will look in <code>../scripts/</code> for scripts and <code>../data/</code> for data, relative to the path of the binary.</p>
<dl class="section warning"><dt>Warning</dt><dd>Be aware that your workspace time is limited. You'll have to use <code>ws_extend</code> at least every month to prevent your workspace from being deleted. This also includes your output, so be sure to extend your workspace time and copy your result out of the workspace asap.</dd></dl>
<hr  />
 <h1><a class="anchor" id="secHermit_Debugging"></a>
Debugging on Hermit</h1>
<p>On Hermit the parallel debugger <em>DDT</em> is available. See <a href="https://wickie.hlrs.de/platforms/index.php/DDT">https://wickie.hlrs.de/platforms/index.php/DDT</a>.</p>
<p>Be sure to compile <b>ug4</b> as a debug build.</p>
<p>DDT uses X11 for its graphical user interface. Be sure to log in with an X window forwarding enabled. This could mean using the <code>-X</code> or <code>-Y</code> option to <code>ssh</code>.</p>
<p><b>Basic usage of <em>DDT</b></em>: </p><ol>
<li>
Load the DDT module: <div class="fragment"><div class="line">module load ddt</div>
</div><!-- fragment -->  </li>
<li>
Start a job in <em>interactive mode</em> with <div class="fragment"><div class="line">qsub -IX [other job options]</div>
</div><!-- fragment --> <code>-X</code> enables X11 forwarding; <code>-X</code> exports all environment variables in qsub's command environment to the job. </li>
<li>
Start DDT by typing <div class="fragment"><div class="line">ddt</div>
</div><!-- fragment -->  </li>
<li>
<p class="startli">Click on "Run and Debug a Program" in the "Welcome" dialog box, enter the executable to debug, numbers of processes to run, the executables parameters etc., then click the "Submit" button.</p>
<p class="endli">One can also immediately specify the application to debug and also its parameters by typing <code>ddt [&lt;your app&gt; &lt;parameters&gt;]</code> </p>
</li>
</ol>
<p>The rest should be quite self-explaining.</p>
<p><b>Example debug session</b>: </p><ol>
<li>
Start interactive session: <div class="fragment"><div class="line">qsub -I -V -X -l mppwidth=64,mppnppn=32,walltime=00:30:00</div>
<div class="line">qsub: waiting <span class="keywordflow">for</span> job 309598.sdb to start</div>
</div><!-- fragment --> I.e, the session in this example lasts 30 minutes.  </li>
<li>
<p class="startli">Start DDT with <code>ugshell</code> as executable and some <b>ug4</b> parameters: </p><div class="fragment"><div class="line">ddt ./ugshell -<a class="code" href="command__line__util_8lua.html#a340d3719e63a0a3a4f4429ef8c8b55ea">ex</a> ../apps/scaling_tests/modular_scalability_test.lua -numPreRefs 1 -hRedistFirstLevel 4 -hRedistStepSize 2 -hRedistNewProcsPerStep 4 -<a class="codeRef" href="../plugins/example__free__surface_2evaluate_8lua.html#ad2464918eb8162cae4af3f470845f0d9">numRefs</a> 8</div>
<div class="ttc" id="acommand__line__util_8lua_html_a340d3719e63a0a3a4f4429ef8c8b55ea"><div class="ttname"><a href="command__line__util_8lua.html#a340d3719e63a0a3a4f4429ef8c8b55ea">ex</a></div><div class="ttdeci">parameterString ex</div><div class="ttdoc">Executes the specified script.</div><div class="ttdef"><b>Definition:</b> command_line_util.lua:350</div></div>
<div class="ttc" id="aexample__free__surface_2evaluate_8lua_html_ad2464918eb8162cae4af3f470845f0d9"><div class="ttname"><a href="../plugins/example__free__surface_2evaluate_8lua.html#ad2464918eb8162cae4af3f470845f0d9">numRefs</a></div><div class="ttdeci">parameterNumber numRefs</div></div>
</div><!-- fragment --><pre class="fragment">&lt;/li&gt;
</pre> </li>
</ol>
<p>Notes: </p><ul>
<li>
<code>-I</code> declares that the job is to be run "interactively". </li>
<li>
<code>-V</code> declares that all environment variables are passed to the job. </li>
<li>
<code>-X</code> Enables X11 forwarding, necessary to get DDT's GUI as X11 window. </li>
<li>
After the job is started with <code>qsub</code> you've entered a new shell, so you have to go (again) into <b>ug4</b>'s bin directory before starting the debugger. </li>
<li>
<p class="startli">When retrying the above procedere the following error message appeared after executing the <code>qsub</code> command (19092012): </p><div class="fragment"><div class="line">PrgEnv-cray/4.0.46(11):ERROR:150: Module <span class="stringliteral">&#39;PrgEnv-cray/4.0.46&#39;</span> conflicts with the currently loaded module(s) <span class="stringliteral">&#39;PrgEnv-gnu/4.0.46&#39;</span></div>
<div class="line">PrgEnv-cray/4.0.46(11):ERROR:102: Tcl command execution failed: conflict PrgEnv-gnu</div>
<div class="line"> </div>
<div class="line">ModuleCmd_Switch.c(172):ERROR:152: Module <span class="stringliteral">&#39;PrgEnv-cray&#39;</span> is currently not loaded</div>
</div><!-- fragment --><p> This can seemingly be ignored. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">In the same test DDT complained that no licence file is found: </p><div class="fragment"><div class="line">ddt ./ugshell ...</div>
<div class="line"> </div>
<div class="line">Unable to obtain valid licence <span class="keywordflow">for</span> DDT.</div>
<div class="line">The licence file tried was specified <span class="keyword">using</span> the (optional) environment</div>
<div class="line">variable specifier DDT_LICENCE_FILE.</div>
<div class="line">The file <span class="stringliteral">&quot;/opt/cray/ddt/3.2/Licence&quot;</span> does not exist.</div>
<div class="line"> </div>
<div class="line">If you <span class="keywordflow">do</span> not already have a licence <span class="keywordflow">for</span> DDT, please visit the Allinea website</div>
<div class="line">http:<span class="comment">//www.allinea.com/products/ddt/ to obtain an evaluation licence.</span></div>
</div><!-- fragment --><p class="interli">According to the message above it was possible to specify the license file of an earlier version: </p><div class="fragment"><div class="line">nid03538:~ igcingo$ export DDT_LICENCE_FILE=/opt/cray/ddt/3.1/Licence</div>
</div><!-- fragment --><p class="endli">So, when executing again the <code>ddt</code> command DDT eventually starts ...  </p>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">ug4 - Documentation</a></li><li class="navelem"><a class="el" href="page_u_g4_setup.html">Setup and Installation</a></li><li class="navelem"><a class="el" href="page_u_g4_install.html">Prerequisites and Recommended Tools</a></li><li class="navelem"><a class="el" href="page_u_g4_setup_parallel.html">Installation on Parallel Computers</a></li>
    <li class="footer">Generated on Mon Apr 3 2023 01:00:37 for ug4 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
