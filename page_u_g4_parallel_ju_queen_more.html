<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ug4: Detailed JuQueen Information</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ug4
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page_u_g4_parallel_ju_queen_more.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Detailed JuQueen Information </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a class="el" href="page_u_g4_parallel_ju_queen_more.html#secJuQueenRack">Rack Information about JuQueen</a></li>
<li><a class="el" href="page_u_g4_parallel_ju_queen_more.html#secGettingStatusInfosOnJuQueen">Getting status information on JuQueen</a></li>
<li><a class="el" href="page_u_g4_parallel_ju_queen_more.html#secVery_large_jobs_on_JuQueen">Very large Jobs on JuQueen</a></li>
<li><a class="el" href="page_u_g4_parallel_ju_queen_more.html#secAvailableFileSystems">Available file systems on JuQueen</a></li>
<li><a class="el" href="page_u_g4_parallel_ju_queen_more.html#secDebuggingAndCorefileAnalysisOnJuQueen">Debugging and corefile analysis on JuQueen</a></li>
</ul>
<h1><a class="anchor" id="secJuQueenRack"></a>
Rack Information about JuQueen</h1>
<p><a href="http://www.fz-juelich.de/ias/jsc/EN/Expertise/Supercomputers/JUQUEEN/JUQUEEN_node.html">JuQueen</a> &mdash; the <a href="http://www.fz-juelich.de/ias/jsc/EN/Expertise/Supercomputers/JUQUEEN/Configuration/Configuration_node.html">24 racks Blue Gene/Q</a> (BG/Q) system at <em>J&uuml;lich Supercomputing Centre (JSC)</em> (FZ J&uuml;lich) &mdash; is the successor of <em>JuGene</em>, the 72 racks BG/P system at FJZ (288 Ki cores; 144 Tbyte RAM; see page <a class="el" href="page_u_g4_parallel_ju_gene.html">JuGene</a> for some documentation), whose installation began in April 2012 with 8 racks.</p>
<p><em>JuQueen</em> currently provides 393.216 cores (384 Ki) and 375 Tbyte RAM in total (late October 2012), organized in 24 racks. It is intended to extend <em>JuQueen</em> to 28 racks (448~Ki cores; source: c't, 15/2012, S. 58).</p>
<dl class="section note"><dt>Note</dt><dd>(TMP) According to the output of <code>llbgstatus</code> command and the sketch provided by <em>llview</em> (see below) it looks like all 28 racks are installed in the last upgrade step, but only 24 racks are active in the moment (in <em>llview</em> the midplanes of those last four racks are labeled with "do", probably meaning "down", while the active ones are labeled with "ru" (i.e. "running"))!</dd></dl>
<p>Each rack contains 2<sup>5</sup> <b>node</b> <b>cards</b>, each consisting of 2<sup>5</sup> <b>compute</b> <b>cards</b> (or compute nodes - CN's).</p>
<p>Each CN has a 16-core IBM PowerPC A2 running at 1.6 GHz (plus one additional core executing the operating system, plus one spare core), with 16 Gbyte SDRAM-DDR3 of RAM in total or 1 Gbyte per core.</p>
<p>So, one rack provides 2<sup>5</sup> &times; 2<sup>5</sup> = 2<sup>10</sup> = 1 Ki CN's, or 16 Ki (16.384) cores. Half a rack (8192 cores) is called a <b>midplane</b>.</p>
<p>According to the <a href="http://www.fz-juelich.de/ias/jsc/EN/Expertise/Supercomputers/JUQUEEN/BGQatJSC.html">announcement of Blue Gene/Q at JSC</a> it should be necessary for efficiency to use a hybrid parallelization strategy (e.g. MPI/OpenMP or MPI/Pthreads) but our results so far indicate that pure MPI parallelization is ok.</p>
<p>One of the four networks is a 5-D torus: Each CN is connected to its six direct neighbors, plus "loops" in all three space dimensions, plus further connections in "fourth" and "fiveth" dimension ...</p>
<ul>
<li>4D are cabled to other midplanes</li>
<li>5th dimension: extent 2 (stays within nodecard)</li>
<li>6th dimension: core number within a CN.</li>
</ul>
<p>For some explanation see the description given <a href="http://www.fz-juelich.de/SharedDocs/Downloads/IAS/JSC/EN/JUQUEEN/BGQJSCTorusHennecke.pdf">here</a> (p. 3).</p>
<p>See more on the architecture of <em>JuQueen</em> in this <a href="http://www.fz-juelich.de/ias/jsc/EN/Expertise/Supercomputers/JUQUEEN/BGQatJSC.html">short description</a> or, in more detail, in these <a href="http://www.fz-juelich.de/SharedDocs/Downloads/IAS/JSC/EN/JUQUEEN/BGQJSCSystemOverviewStephan.pdf">system overview slides</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Note that the login nodes are running under <em>Linux</em> (Red Hat Enterprise Linux Server (release 6.3 (Santiago), as of October 2012)), while the CNs are running a limited version of Linux called <em>Compute Node Kernel</em> (CNK). Therefore it is necessary to <b>cross-compile</b> for <em>JuQueen</em> (cf. sec. <a class="el" href="page_u_g4_setup_parallel.html#secCMake">CMake, Toolchains, Compilers</a>; sec. <a class="el" href="page_u_g4_parallel_ju_queen.html#secConfiguration_of_ug4_for_JuQueen">Configuration of ug4 for JuQueen</a>).</dd></dl>
<hr  />
 <h1><a class="anchor" id="secWorking_with_ug4_on_JuQueen"></a>
Working with ug4 on JuQueen</h1>
<h2><a class="anchor" id="secBasic_job_handling"></a>
Basic Job Handling</h2>
<p>You can use <code>ugsubmit</code> to run your jobs on JUQUEEN. Make sure to source ug4/trunk/scripts/shell/ugbash and to export the variables </p><div class="fragment"><div class="line">export UGSUBMIT_TYPE=Juqueen</div>
<div class="line">export UGSUBMIT_EMAIL=your@email.com</div>
</div><!-- fragment --><p> e.g. in <code>~/.bashrc</code>. (of course you have to replace '<a href="#" onclick="location.href='mai'+'lto:'+'you'+'r@'+'ema'+'il'+'.co'+'m'; return false;">your@<span style="display: none;">.nosp@m.</span>emai<span style="display: none;">.nosp@m.</span>l.com</a>' with your real email adress...).</p>
<h3><a class="anchor" id="secInteractive_jobs"></a>
Interactive jobs</h3>
<p><b>Not possible</b> in the moment!</p>
<h3><a class="anchor" id="secBatch_jobs"></a>
Batch jobs</h3>
<p>Read <a class="el" href="pageugsubmit.html">ugsubmit - Job Scheduling on Clusters</a> for further instructions on unified <code>ugsubmit</code> usage.</p>
<dl class="section warning"><dt>Warning</dt><dd>Make sure to execute all batch jobs on the $WORK partition of Juqueen. Access to $HOME from the compute-nodes is not only slow but will likely cause other troubles, too.</dd></dl>
<h2><a class="anchor" id="secBasic_manual_job_handling"></a>
Manual Job Handling using LoadLeveler (not recommended)</h2>
<dl class="section note"><dt>Note</dt><dd><code>ugsubmit</code> (<a class="el" href="pageugsubmit.html">ugsubmit - Job Scheduling on Clusters</a>) does the job of submitting jobs for you. It is strongly recommendet to use it! The following section is thus only of concern to people who want to submit jobs manually.</dd></dl>
<p>For some basic information see the <a href="http://www.fz-juelich.de/ias/jsc/EN/Expertise/Supercomputers/JUQUEEN/UserInfo/QuickIntroductionJuqueen.html">Quick Introduction</a> to job handling and the references therein. Here we only provide some important details (everything else should become clear by examining the examples provided):</p>
<p>Batch jobs are submitted with the <b><code>llsubmit</code> command</b>. The command is typically executed in the directory where the ug4 executable resides ("ug4-bin"): </p><div class="fragment"><div class="line">llsubmit &lt;jobscript&gt;</div>
</div><!-- fragment --><p> <a href="http://www2.fz-juelich.de/jsc/jugene/usage/loadl/llsubmit/"><code>llsubmit</code></a> invokes the <em>IBM Tivoli Workload Scheduler LoadLeveler</em> (TWS <b>LoadLeveler</b>), which is used as <b>batch system</b> on Blue Gene/Q.</p>
<p>The <b>script</b> <code>&lt;jobscript&gt;</code> &mdash; also called <b>"LoadLeveler script"</b> &mdash; is a (plain Unix) shell script file and contains the actual job definitions, specified by <b>"LoadLeveler keywords"</b> (some prominent examples are explained below) and a call of the <code>runjob</code> command (also introduced below). It can also contain standard Unix commands.</p>
<p>If <code>llsubmit</code> was able to submit the job it outputs a <b>job name</b> (or <b>job-id</b>; e.g. <code>juqueen1c1.40051.0</code>) with which a specific job can be identified in further commands, e.g. to cancel it (see below).</p>
<p>The <b>output</b> of the run (messages from Frontend end Backend MPI &mdash; and the output of <b>ug4</b> &mdash; is written to a file in the directory where <code>llsubmit</code> was executed and whose name begins with the job name you have specified in the LoadLeveler script and ends with <code>&lt;job-id&gt;.out</code> (see below how to specify the job name).</p>
<p><b>Some details concerning the definition of batch jobs</b>: </p><ul>
<li>
<p class="startli"><b>Example LoadLeveler scripts</b> used with <b>ug4</b> can be found in <b>ug4</b>'s sub directory <code>scripts/shell/</code>:</p>
<ul>
<li><code>ll_scale_gmg_bgq.x</code> contains job definitions for a scalability study from 4 to 64 Ki PE (2-D Laplace, solved with geometric multigrid).</li>
</ul>
<p class="interli">(All <code>runjob</code> commands therein are commented out &mdash; to perform a specific run remove its comment sign.)</p>
<p class="interli"><b>Hint</b>: It might be helpful for the understanding of the following details to open an example LoadLeveler script in your favorite text editor!</p>
<p class="interli">If you want to use one of these scripts copy it to your "ug4-bin" directory. Please change at least the value of the <code>notify_user</code> keyword (see below) before submitting a job ... Furthermore it might be good to check (and possibly change) the values of some keywords (especially <code>bg_size</code>; search for the string "TO CHECK")!</p>
<p class="interli">See also this <a href="http://www.fz-juelich.de/ias/jsc/EN/Expertise/Supercomputers/JUQUEEN/UserInfo/LoadLeveler.html">batch job documentation</a>, and especially the <a href="http://www.fz-juelich.de/ias/jsc/EN/Expertise/Supercomputers/JUQUEEN/UserInfo/LoadLevelerSamples.html">Job File Samples</a> for more details. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>LoadLeveler keywords</b> are strings embedded in comments beginning with the characters <code>"# @"</code>. <br  />
 These keywords inform the LoadLeveler of the resources required for the job to run, the job environment, the name of output files, notification of the user about job result etc.</p>
<dl class="section note"><dt>Note</dt><dd>Please note that keywords <b>must not be followed by comments</b> in the same line!</dd></dl>
<p>A few important keywords: </p><ul>
<li>
<code>job_type = bluegene</code> specifies that the job is running on <em>JuQueen's</em> CNs.  </li>
<li>
<code>job_name</code> specifies the name of the job, which will become part of the name of the output file (see above).  </li>
<li>
<p class="startli"><code>bg_size</code> specifies the size of the BG/Q partition reserved for the job in <b>number of compute nodes</b>.</p>
<p class="interli">That is, for <code>&lt;NP&gt;</code> MPI processes, <code>bg_size</code> must be &ge; <code>(&lt;NP&gt;)/16</code> (since one CN has 16 cores).</p>
<p class="interli">From the documentation, section "Blue Gene specific keywords" in this <a href="http://www.fz-juelich.de/ias/jsc/EN/Expertise/Supercomputers/JUQUEEN/UserInfo/LoadLeveler.html">batch job documentation</a>:</p>
<p class="interli">Blue Gene/Q only allows blocks including 32, 64, 128, 256 and multiples of 512 compute nodes. <br  />
 Thus e.g. <code>bg_size</code> of 1 specifies a block of size 32 and <code>bg_size</code> of 129 requests a partition of size 256.</p>
<dl class="section note"><dt>Note</dt><dd>Please note that the actual number of MPI processes of a job is (as usual) specified by a parameter of the <code>runjob</code> command described below. <br  />
 But since the <code>bg_size</code> is relevant for charging of computing time it is wise to keep its value as small as possible.</dd></dl>
<p>Alternatively the size of a job can be defined by the <code>bg_shape</code> keyword (see same source for details).</p>
<p class="interli">See comments in the example LoadLeveler scripts for proper settings. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><code>bg_connectivity</code> specifies the "connection type", i.e. the <b>network topology</b> used by a job.</p>
<p class="interli">Connection type can be one in <code>[TORUS| MESH | EITHER | &lt;Xa Xb Xc Xd&gt;]</code>.</p>
<p class="interli">The specification for <code>Xy</code> is equal to Torus or Mesh, specified for the <code>y</code> dimension. Default is <code>MESH</code>.</p>
<pre class="fragment">    &lt;tt&gt;bg_connection = TORUS&lt;/tt&gt; &amp;mdash; utilising the 5-D torus network 
    &amp;mdash; is the preferred topology for our jobs.
    &lt;!--On JuGene: For TORUS &lt;tt&gt;bg_size&lt;/tt&gt; (see above) must be &gt;= 512. - is there also such a limit on JuQueen? --&gt;

    See also comments and usage in the example LoadLeveler scripts for proper
    settings.

    \note The connection type is on JuQueen described by the keyword
    \c bg_connectivity instead of \c bg_connection as it was on JuGene!
  &lt;/li&gt;
&lt;/ul&gt;

A nice introduction to LoadLeveler command file syntax is given e.g. 
&lt;a href="https://docs.loni.org/wiki/LoadLeveler_Command_File_Syntax"&gt;here&lt;/a&gt;
(please keep in mind that, to the authors knowledge, this documentation is
\em not (especially) about Blue Gene machines).
</pre> <p class="endli"></p>
</li>
<li>
<p class="startli"><b>Jobs are actually started</b> by the <code>runjob</code> command (this replaces the <code>mpirun</code> command used on JuGene).</p>
<p class="interli"><b>Example</b>: </p><div class="fragment"><div class="line">runjob --np 64 --ranks-per-node 16 --mapping ABCDET --<a class="code" href="checkpoint__util_8lua.html#a7e587ebfa42129125fe2e79410a09ef8">verbose</a> 3 : ./ugshell -<a class="code" href="command__line__util_8lua.html#a340d3719e63a0a3a4f4429ef8c8b55ea">ex</a> ../apps/conv_diff/laplace.lua</div>
<div class="ttc" id="acheckpoint__util_8lua_html_a7e587ebfa42129125fe2e79410a09ef8"><div class="ttname"><a href="checkpoint__util_8lua.html#a7e587ebfa42129125fe2e79410a09ef8">verbose</a></div><div class="ttdeci">location verbose</div><div class="ttdef"><b>Definition:</b> checkpoint_util.lua:128</div></div>
<div class="ttc" id="acommand__line__util_8lua_html_a340d3719e63a0a3a4f4429ef8c8b55ea"><div class="ttname"><a href="command__line__util_8lua.html#a340d3719e63a0a3a4f4429ef8c8b55ea">ex</a></div><div class="ttdeci">parameterString ex</div><div class="ttdoc">Executes the specified script.</div><div class="ttdef"><b>Definition:</b> command_line_util.lua:350</div></div>
</div><!-- fragment --><p> This starts a job with 64 MPI processes, running on 4 CN's, where on each CN one process per core is executed.</p>
<p class="interli">Some explanations to te <code>runjob</code> parameters used above: </p><ul>
<li>
The <code>runjob</code> parameter <code>&ndash;np &lt;n&gt;</code> specifies the number <code>&lt;n&gt;</code> of MPI processes of the entire job.  </li>
<li>
<p class="startli">The <code>runjob</code> parameter <code>&ndash;ranks-per-node &lt;r&gt;</code> specifies the number of ranks per CN: <code>&lt;r&gt;</code> in <code>{1, 2, 4, 8, 16, 32, 64}</code> (default: <code>&lt;r&gt; = 1</code>).</p>
<p class="interli">Background: Each of the 16 cores of a CN is four-way hardware threaded =&gt; 64 process/threads per CN possible. <br  />
 Please note that in this case each process/thread has only 16 Gbyte/64 = 256 Mbyte available.</p>
<p class="interli">There are three "execution modes":</p><ul>
<li>64 MPI tasks &ndash; 1 Thread per task.</li>
<li>2, 4, 8, 16, 32 MPI tasks &mdash; 32, 16, 8, 4, 2 Threads per task.</li>
<li>1 MPI task &ndash; 64 Threads per task.</li>
</ul>
<p class="endli">See e.g. <a href="http://www.fz-juelich.de/SharedDocs/Downloads/IAS/JSC/EN/JUQUEEN/BGQJSCOverviewVezolle.pdf">here</a> (p. 10) and <a href="http://www.fz-juelich.de/SharedDocs/Downloads/IAS/JSC/EN/JUQUEEN/BGQJSCSystemOverviewStephan.pdf">here</a> (p. 20).   </p>
</li>
<li>
The <code>runjob</code> parameter <code>&ndash;exe &lt;executable&gt;</code> specifies the executable.  </li>
<li>
<p class="startli">The <code>runjob</code> parameter <code>&ndash;args</code> specifies the arguments of the executable (and not of the <code>runjob</code> command!)</p>
<p class="interli">NOTE: There is a different syntax for the command used in the example above, where the executable and its arguments are separated by a colon (":"), and where <em>no</em> <code>&ndash;exe</code> and <em>no</em> <code>&ndash;args</code> parameter has to be specified! This seems to be the preferred way!</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <code>runjob</code> parameter <code>-mapping</code> specifies an order in which the MPI processes are mapped to the CNs / the cores of the BG/Q partition reserved for the run.</p>
<p class="interli">This order can either be specified by a permutation of the letters A, B, C, D, E and T <em>or</em> the name of a mapfile in which the distribution of the tasks is specified, <code>-mapping {&lt;mapping&gt;|&lt;mapfile&gt;}</code>: </p><ul>
<li>
<code>&lt;mapping&gt;</code> is a permutation of A, B, C, D, E and T, where A, B, C, D, E are the torus coordinates of the CN's in the partition and T is the number of the cores within each node (T=0,1,2,...,15). The standard mapping on <em>JuQueen</em> is to place the tasks in "ABCDET" order &mdash; T increments first, then E (which can become maximal 2 on BG/Q) etc.  </li>
<li>
<p class="startli"><code>&lt;mapfile&gt;</code> is the name of a mapfile in which the distribution of the tasks is specified:</p>
<p class="endli">It contains a line of <code>A B C D E T</code> coordinates for each MPI process.  </p>
</li>
</ul>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <code>runjob</code> parameter <code>&ndash;verbose &lt;level&gt;</code> specifies the "verbosity level" of the job output. The lowest level is 0 or "OFF" (or "O"), the highest level is 7 or "ALL (or "A").
    Level 3 or "WARN" (or "W") seems to be a good compromise between "briefness"
    and "ausschweifenden" system informations.</p>
<p class="interli">Please note that a verbosity level higher than 3 tends to mix up system output and output produced by <b>ug4</b> itself which looks really messy (but might give sometime helpful debug informations)</p>
<p class="endli"></p>
</li>
</ul>
<p class="endli"></p>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="secFurther_LoadLeveler_Commands"></a>
Further LoadLeveler Commands</h3>
<ul>
<li>
<p class="startli">To <b>display the status of jobs</b> in the queue you can use the <code>llq</code> command. This prints the job names ("Id's"), owners of jobs, submission times etc. and where it is running (or not).</p>
<ul>
<li>
<p class="startli">To display the status of jobs of a specified user use </p><div class="fragment"><div class="line">llq [-u  &lt;userid&gt;]</div>
</div><!-- fragment --><p class="interli">This displays all jobs in the queue submitted by the user with id <code>&lt;userid&gt;</code>. Example (only one job in the queue, not running): </p><div class="fragment"><div class="line">llq -u hfu023</div>
<div class="line">Id                       Owner      Submitted   ST PRI Class        Running On </div>
<div class="line">------------------------ ---------- ----------- -- --- ------------ -----------</div>
<div class="line">juqueen1c1.40051.0       hfu023     10/25 17:01 I  50  n004                    </div>
</div><!-- fragment --> <p class="endli"></p>
</li>
<li>
The <b>estimated start time</b> of a job can be determined by <code>llq -s &lt;jobid&gt;</code> (cf. <a href="https://docs.loni.org/wiki/Useful_LoadLeveler_Commands">this intro</a> (already cited above)), where <code>&lt;job-id&gt;</code> was determined by the previous command, e.g. for the job <code>juqueen1c1.40051.0</code>: <div class="fragment"><div class="line">llq -<a class="codeRef" href="../plugins/_biogas_8lua.html#a9dda901d5ee6289370201a700f88e789">s</a> juqueen1c1.40051.0</div>
<div class="line"> </div>
<div class="line">===== EVALUATIONS FOR JOB STEP juqueen1c1.zam.kfa-juelich.de.40051.0 =====</div>
<div class="line"> </div>
<div class="line">Step state                       : Idle</div>
<div class="line">Considered <span class="keywordflow">for</span> scheduling at     : Fri 02 Nov 2012 21:51:56 CET</div>
<div class="line"> </div>
<div class="line"><a class="code" href="namespaceug.html#a6d3204d2ad8fe73791f0811cad9c584c">Minimum</a> initiators needed: 1 per machine, 1 total.</div>
<div class="line">Machine juqueen1c1.zam.kfa-juelich.de does not support job <span class="keyword">class </span>n004.</div>
<div class="line">3 machines do not support job class n004.</div>
<div class="line">No machine can be used to run this job step.</div>
<div class="ttc" id="a_biogas_8lua_html_a9dda901d5ee6289370201a700f88e789"><div class="ttname"><a href="../plugins/_biogas_8lua.html#a9dda901d5ee6289370201a700f88e789">s</a></div><div class="ttdeci">parameterString s</div></div>
<div class="ttc" id="anamespaceug_html_a6d3204d2ad8fe73791f0811cad9c584c"><div class="ttname"><a href="namespaceug.html#a6d3204d2ad8fe73791f0811cad9c584c">ug::Minimum</a></div><div class="ttdeci">number Minimum(SmartPtr&lt; TGridFunction &gt; spGridFct, const char *cmp, const char *subsets)</div><div class="ttdef"><b>Definition:</b> integrate.h:1061</div></div>
</div><!-- fragment -->  </li>
</ul>
<p class="endli"></p>
</li>
<li>
<p class="startli">To <b>cancel a job</b> you have to use the <code>llcancel</code> command. The job to be cancelled has to be specified by its <code>&lt;job-id&gt;</code> (as displayed by <code>llq</code>): </p><div class="fragment"><div class="line">llcancel &lt;job-<span class="keywordtype">id</span>&gt;</div>
</div><!-- fragment --> <p class="endli"></p>
</li>
<li>
Informations about running and queued jobs etc. can also be displayed by the graphical tool <em>llview</em> (see <a class="el" href="page_u_g4_parallel_ju_queen_more.html#secGettingStatusInfosOnJuQueen">Getting status information on JuQueen</a>).  </li>
</ul>
<hr  />
 <h2><a class="anchor" id="secGettingStatusInfosOnJuQueen"></a>
Getting status information on JuQueen</h2>
<ul>
<li>
<p class="startli"><b>Graphical monitoring tool <em>llview</b></em>: <br  />
 <em>llview</em> has a graphical X11 based user interface and provides a <b>schematical sketch</b> of the machine It displays system status, running jobs, scheduling and prediction of the start time of jobs. The latter can also be achieved by the <code>llq</code> command, see above).</p>
<p class="interli">See the JuGene documentation <a href="http://www.fz-juelich.de/ias/jsc/EN/Expertise/Supercomputers/JUGENE/UserInfo/llview.html"><code>llview</code></a> </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>Status of the whole machine</b> is displayed by the <code>llbgstatus</code> command: </p><div class="fragment"><div class="line">llbgstatus  </div>
<div class="line">Name         Midplanes       ComputeNodes    InQ Run</div>
<div class="line">BGQ          2x7x2x2         28672           975   0</div>
</div><!-- fragment --><p> See <code>man llbgstatus</code> for more information. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b>Status information about your account</b>: Querying <b>Quota Status</b>: </p><div class="fragment"><div class="line">q_cpuquota &lt;options&gt;</div>
</div><!-- fragment --><p class="endli">Useful options: </p><ul>
<li><code>-?</code> usage information and all options . </li>
<li><code>-j &lt;jobstepid&gt;</code> for a single job. </li>
<li><code>-t &lt;time&gt;</code> for all jobs in the specified time, e.g. <code>q_cpuquota -t 23.11.2011 01.12.2011</code>. </li>
<li><code>-d &lt;number&gt;</code> for last number of days (positive integer).  </li>
</ul>
</li>
</ul>
<hr  />
 <h2><a class="anchor" id="secVery_large_jobs_on_JuQueen"></a>
Very large Jobs on JuQueen</h2>
<ul>
<li>
Use <a class="el" href="page_u_g4_setup_parallel.html#secStaticBuild">Static Builds</a> . So, for <b>very large jobs</b> be sure to have <b>ug4</b> built as a <b>completely static executable</b> (c.f. <a class="el" href="page_u_g4_parallel_ju_queen.html#secConfiguration_of_ug4_for_JuQueen">Configuration of ug4 for JuQueen</a>) since otherwise loading of the shared libraries consumes too much wall time!  </li>
<li>
<p class="startli"><b>Very large jobs</b> (e.g. jobs larger than 32 racks) normally run on <b>Tuesday</b> only.</p>
<p class="endli">Exceptions to this rule are possible in urgent cases (please contact the SC Support under <a href="sc@fz-juelich.de">sc@fz-juelich.de</a>).  </p>
</li>
</ul>
<hr  />
 <h2><a class="anchor" id="secAvailableFileSystems"></a>
Available file systems on JuQueen</h2>
<p>See <a href="http://www.fz-juelich.de/ias/jsc/EN/Expertise/Supercomputers/JUDGE/Userinfo/Access_Environment.html">this</a> JSC documentation, section "Other filesystems", for some details.</p>
<hr  />
 <h2><a class="anchor" id="secDebuggingAndCorefileAnalysisOnJuQueen"></a>
Debugging and corefile analysis on JuQueen</h2>
<p>As usual you need to compile <b>ug4</b> in "debug mode" (i.e. configured with <code>cmake -DDEBUG=ON ..</code>; cf. <a class="el" href="page_build_u_g4.html#secBuildUG4RunCmake">Run CMake</a>) so that the necessary debugging information is available.</p>
<h3><a class="anchor" id="secDebuggingOnJuQueen"></a>
Debugging on JuQueen</h3>
<p>Since November 2012 a parallel debugger, <em>TotalView</em>, is (eventually) available on <em>JuQueen</em>.</p>
<p><b>Basic usage of <em>TotalView</b></em>:</p>
<p><em>TotalView</em> uses X11 for its graphical user interface. Be sure to log in with an X window forwarding enabled. This could mean using the <code>-X</code> or <code>-Y</code> option to <code>ssh</code> (on <em>all</em> ssh connections if you aren't connected directly (cf. ref secSSHHopping)).</p>
<ol>
<li>
<p class="startli">Load the appropriate module: </p><div class="fragment"><div class="line">module load UNITE totalview</div>
</div><!-- fragment --> <p class="interli">(UNITE &mdash; "UNIform Integrated Tool Environment" for debugging and performance analysis",
see &lt;a href="<a href="http://apps.fz-juelich.de/unite/index.php/Main_Page">http://apps.fz-juelich.de/unite/index.php/Main_Page</a>"&gt;here.)</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Use the <code>lltv</code> command to start <em>TotalView</em> (cf. output of <code>module help totalview</code>): </p><div class="fragment"><div class="line">lltv -n &lt;numNodes&gt; : -default_parallel_attach_subset=&lt;rank-range&gt; runjob -a --exe &lt;executable&gt; -np &lt;numProcs&gt; --ranks-per-node &lt;number&gt;</div>
</div><!-- fragment --><p> In the <em>Totalview</em> windows appearing as soon as the job has started specify/control your parameters, then run your job, as illustrated in the following example.</p>
<p class="endli">This will start the executable <code>&lt;executable&gt;</code> to be debugged on <code>&lt;numNodes&gt;</code> nodes utilising <code>&lt;numProcs&gt;</code> processes, attaching <em>TotalView</em> to ranks <code>&lt;rank-range&gt;</code> (a space separated list of ranks, see documentation). </p>
</li>
</ol>
<p><b>Example session</b>: </p><ol>
<li>
<p class="startli">Start the debugger: </p><div class="fragment"><div class="line">lltv -n 1 : -default_parallel_attach_subset=0-15 runjob -a --np 16 --ranks-per-node 16 --mapping ABCDET --<a class="code" href="checkpoint__util_8lua.html#a7e587ebfa42129125fe2e79410a09ef8">verbose</a> 3 : ./ugshell -<a class="code" href="command__line__util_8lua.html#a340d3719e63a0a3a4f4429ef8c8b55ea">ex</a> scaling_tests/modular_scalability_test.lua -<a class="codeRef" href="../plugins/group__small__strain__mechanics.html#ga425548c7b0fe054612f37d1f3a4826b6">dim</a> 2 -grid unit_square_01/unit_square_01_quads_8x8.ugx -lsMaxIter 100 -numPreRefs 3 -lsType feti -ds famg -ns famg -numPPSD 4 -<a class="codeRef" href="../plugins/example__free__surface_2evaluate_8lua.html#ad2464918eb8162cae4af3f470845f0d9">numRefs</a> 4</div>
<div class="ttc" id="aexample__free__surface_2evaluate_8lua_html_ad2464918eb8162cae4af3f470845f0d9"><div class="ttname"><a href="../plugins/example__free__surface_2evaluate_8lua.html#ad2464918eb8162cae4af3f470845f0d9">numRefs</a></div><div class="ttdeci">parameterNumber numRefs</div></div>
<div class="ttc" id="agroup__small__strain__mechanics_html_ga425548c7b0fe054612f37d1f3a4826b6"><div class="ttname"><a href="../plugins/group__small__strain__mechanics.html#ga425548c7b0fe054612f37d1f3a4826b6">dim</a></div><div class="ttdeci">static const int dim</div></div>
</div><!-- fragment --><p class="interli">I.e., to get the corresponding interactive debug job one can (to the authors experience so far) just add the <code>runjob</code> line of a batch job definition (as written in a LoadLeveler script; see above) after the colon of the <code>lltv</code> command <b>PLUS add the option <code>-a</code> to the <code>runjob</code> command</b>!</p>
<p class="interli">The system answers with something like </p><div class="fragment"><div class="line">Creating LoadLeveler Job</div>
<div class="line">Submiting LoadLeveler Interactive Job <span class="keywordflow">for</span> TotalView</div>
<div class="line"> Wait <span class="keywordflow">for</span> job juqueen1c1.49410.0 to be started:......</div>
</div><!-- fragment --><p class="interli">Additionally <em>TotalView</em> displays three windows (and a few temporary windows) after the job has started:</p><ul>
<li>a shell-like window titled "totalview" (with black background, which will later display the output of the executable to be debugged),</li>
<li>the "root window", titled "TotalView &lt;Version number&gt;" (which will contain the list of attached processes), and (typically a bit later)</li>
<li>the "process window", first titled "ProcessWindow", the TotalView GUI (which title later changes to "runjob" and then to something like "runjob&lt;ugshell&gt;.3" in our case), and the (temporary) "startup-parameter" window, titled "Startup Parameters".</li>
</ul>
<p class="interli">Depending on system load / network traffic you will experience some waiting time. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">In the "startup-parameter" window enter at least your <b>ug4</b> arguments (or control your arguments given on the command line) in the "Arguments" tag.</p>
<p class="interli">According to the message in the "Parallel" tag do not change anything here. When finished with your input click "OK". </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">In the TotalView GUI press the "GO" button first.</p>
<p class="interli">Another (dialog) window appears with the question "Process runjob is a parallel job. Do you want to stop the job now?" which one has to answer with "YES" (which is not really intuitive ...).</p>
<p class="interli">Another small window appears showing a progress bar while starting the job ("Loading symbos from shell ..."). </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">In the TotalView GUI press the "GO" button again to run your executable. Now you can begin your debugging work.</p>
<p class="endli"></p>
</li>
</ol>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>Maybe some notes about available "Tools" like the "call graph" would be nice. For the moment try yourself and/or see the TotalView docu (links below).</dd></dl>
<p><b>Additional hints</b> </p><ul>
<li>
<p class="startli">As for batch jobs it is possible to shorten a command line as the one in the example by using an environment variable, e.g. </p><div class="fragment"><div class="line">UGARGS2D=<span class="stringliteral">&quot;-ex scaling_tests/modular_scalability_test.lua -dim 2 -grid unit_square_01/unit_square_01_quads_8x8.ugx -lsMaxIter 100 -numPreRefs 3 -lsType feti -ds famg -ns famg -numPPSD 4&quot;</span></div>
<div class="line">lltv -n 1 : -default_parallel_attach_subset=0-15 runjob -a --np 16 --ranks-per-node 16 --mapping ABCDET --<a class="code" href="checkpoint__util_8lua.html#a7e587ebfa42129125fe2e79410a09ef8">verbose</a> 3 : ./ugshell $UGARGS2D -<a class="codeRef" href="../plugins/example__free__surface_2evaluate_8lua.html#ad2464918eb8162cae4af3f470845f0d9">numRefs</a> 4</div>
</div><!-- fragment --> <p class="endli"></p>
</li>
<li>
<p class="startli">The parameter <code>-default_parallel_attach_subset=0-15</code> is optional if one want to attach to all MPI processes. </p>
<p class="endli"></p>
</li>
<li>
TotalView startup actions can be defined on a per user basis in <code>~/.totalview</code>.  </li>
</ul>
<p>Additional information for debugging with <em>TotalView</em> on JuQueen might be found in <a href="http://www.fz-juelich.de/ias/jsc/EN/Expertise/Supercomputers/JUQUEEN/UserInfo/ParallelDebugging.html">this FZJ short introduction to parallel debugging</a>.</p>
<p>For detailed information see</p><ul>
<li>See <code>${TV_ROOT}/doc/pdf/</code> &mdash; this is something like <code>/usr/local/UNITE/packages/totalview/toolworks/totalview.8.11.0-0/doc/pdf/</code> (December 2012).</li>
<li><a href="http://www.roguewave.com/products/totalview.aspx">http://www.roguewave.com/products/totalview.aspx</a></li>
</ul>
<p><b>Basic usage of <em>DDT</b></em>: </p><dl class="section note"><dt>Note</dt><dd>In the moment (December 2012) <em>DDT</em> is <em>not</em> available on JuQueen! So, in the moment the following instructions about <em>DDT</em> (tested on JuGene only!) is meant as a "placeholder".</dd></dl>
<p>DDT uses X11 for its graphical user interface. Be sure to log in with an X window forwarding enabled. This could mean using the <code>-X</code> or <code>-Y</code> option to <code>ssh</code>.</p>
<ol>
<li>
Load the appropriate module: <div class="fragment"><div class="line">module load UNITE ddt</div>
</div><!-- fragment -->  </li>
<li>
Start DDT by typing <code>ddt</code>. </li>
<li>
A "DDT" logo appears, wait a bit (or click on the logo) to get the welcome dialog box. </li>
<li>
Click on "Run and Debug a Program" in the "Welcome" dialog box </li>
<li>
<p class="startli">Enter your <b>ug4</b> parameters (don't forget to enclose them by quotation marks), numbers of processes to run, a (hopefully) appropriate wall time to do all your debugging work (after "Queue submission Parameters"), "MPIRun parameters" (e.g. <code>-mode VN -mapfile TXYZ -verbose 2</code>) in the fields provided after clicking "Advanced\&gt;\&gt;" etc., then click the "Submit" button.</p>
<p class="interli">Wait until the job is launched (you might exercise some patience), DDT will catch the focus automatically when resources are available.</p>
<p class="interli">The rest should be quite self-explaining.</p>
<p class="interli">One can also immediately specify the application to debug and also its parameters by typing <code>ddt [&lt;your app&gt; &lt;parameters&gt;]</code>.</p>
<p class="endli"></p>
</li>
</ol>
<p><b>Example <em>DDT</em> session</b> (directly specifying the executable to debug on the command line): </p><div class="fragment"><div class="line">ddt</div>
</div><!-- fragment --><p>Specification of executable and parameters should also work &mdash; </p><div class="fragment"><div class="line">ddt ./ugshell_debug -<a class="code" href="command__line__util_8lua.html#a340d3719e63a0a3a4f4429ef8c8b55ea">ex</a> ../apps/scaling_tests/modular_scalability_test.lua -<a class="codeRef" href="../plugins/example__free__surface_2evaluate_8lua.html#ad2464918eb8162cae4af3f470845f0d9">numRefs</a>  7</div>
</div><!-- fragment --><p>The mpirun parameters, e.g. <code>-mapfile TXYZ -verbose 2</code> can be placed in the fields accessible after clicking on the "Advanced" button.</p>
<h3><a class="anchor" id="secAnalysOfCorefiles"></a>
Analysis of corefiles with the Coreprocessor tool</h3>
<p>If a job crashes normally one or more corefiles are created. Corefiles are plain text files (stored in the "Parallel Tools Consortium Lightweight Corefile Format") and named like <code>core.0</code>, <code>core.1</code>, <code>core.2</code>, ...</p>
<p>You can analyze those corefiles so that you hopefully are able to find the cause of the crash. The appropriate way to accomplish this task on JuQueen is using a <b>tool called <code>coreprocessor.pl</code></b>. This is a perl script which provides a X11 based GUI.</p>
<p><b>Usage</b>: </p><ol>
<li>
<p class="startli">Go into your "ug4-bin" directory, then start <code>coreprocessor:</code> </p><div class="fragment"><div class="line">/bgsys/drivers/ppcfloor/coreprocessor/bin/coreprocessor.pl</div>
</div><!-- fragment --><p class="endli"></p>
</li>
<li>
Load corefiles: "Select File - Load Core". </li>
<li>
Specify the executable with which the corefile(s) was (were) produced. </li>
<li>
<p class="startli">From the drop down list "Select Grouping Mode" select e.g. "Stack Traceback (detailed)".</p>
<p class="endli">As a result the call stack (or "(back) trace") which describes the call order of all active methods/functions is listed in the main window. Each line contains the name and parameters of the method called. When clicking/marking a line (a frame) of this trace, the filename and the line number of the call is shown at the bottom of the window.  </p>
</li>
<li>
Optional: Save the trace in a file for later analysis. </li>
</ol>
<p>More convenient is to specify the location of the corefiles and the executable directly on the commandline (after loading proceed with step 3 from above): </p><div class="fragment"><div class="line">/bgsys/drivers/ppcfloor/coreprocessor/bin/coreprocessor.pl -c=. -b=ugshell</div>
</div><!-- fragment --><p> <code>-b=ugshell</code> specifies the executable ("binary"), i.e. <code>ugshell</code>, and <code>-c=.</code> means load all corefiles in working directory.</p>
<p>For more usage information execute </p><div class="fragment"><div class="line">/bgsys/drivers/ppcfloor/coreprocessor/bin/coreprocessor.pl -h</div>
</div><!-- fragment --><p>Maybe you can find some additional information in this <a href="http://www.alcf.anl.gov/resource-guides/coreprocessor">ALCF documentation</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">ug4 - Documentation</a></li><li class="navelem"><a class="el" href="page_u_g4_setup.html">Setup and Installation</a></li><li class="navelem"><a class="el" href="page_u_g4_install.html">Prerequisites and Recommended Tools</a></li><li class="navelem"><a class="el" href="page_u_g4_setup_parallel.html">Installation on Parallel Computers</a></li><li class="navelem"><a class="el" href="page_u_g4_parallel_ju_gene.html">JuGene</a></li><li class="navelem"><a class="el" href="page_u_g4_parallel_ju_queen.html">JuQueen</a></li>
    <li class="footer">Generated on Thu Feb 2 2023 17:03:14 for ug4 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
